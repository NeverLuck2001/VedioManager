# 自用视频管理小软件（Windows / 离线）

这是一个基于 **PyQt6** 的本地离线小工具，用于快速人工筛选视频：
- 首级目录扫描视频（按修改时间从新到旧）
- 评分（91~100）+ 标签多选
- ffmpeg 截图预览（异步生成 + 本地缓存）
- 固定模板重命名：`{score}-{tags}-{code}{ext}`
- 直接删除（无确认弹窗）
- 调用 PotPlayer 播放

> 不联网、无账号系统、单机可用。

---

## 1. 环境要求

- Windows 10 / 11
- Python 3.10+
- ffmpeg / ffprobe（建议加入 PATH，或在代码中写绝对路径）
- PotPlayer（在代码中配置 `POTPLAYER_EXE`）

---

## 2. 安装依赖

在项目目录执行：

```bash
pip install -r requirements.txt
```

---

## 3. 配置项（在 `main.py` 顶部）

请按你的环境修改以下常量：

- `DEFAULT_DIR`：默认扫描目录，例如 `r"D:\Videos\Inbox"`
- `POTPLAYER_EXE`：PotPlayer 可执行文件绝对路径
- `FFMPEG_EXE`：`ffmpeg` 命令或绝对路径
- `FFPROBE_EXE`：`ffprobe` 命令或绝对路径
- `SCREENSHOT_COUNT`：截图数量，默认 12
- `VIDEO_EXTS`：支持的视频后缀集合
- `TAGS`：10 个中文标签，可自定义
- `MULTI_TAG_MODE`：`True` 多选，`False` 单选

---

## 4. 运行

```bash
python main.py
```

---

## 5. 交互说明

- **选择文件夹**：切换扫描目录（仅扫描首级目录，不递归）
- **过滤框（左上）**：按文件名 / 评分 / 标签关键字实时筛选当前目录视频
- **评分按钮（91~100）**：设置当前视频评分
- **标签按钮（10 个）**：默认多选，可切换单选模式；支持宽度自适应自动换行（最多三行）
- **确认 / 下一个**：始终跳到下一个；仅当评分和标签都已填写时触发重命名
- **上一个**：切换到上一个；当评分和标签都已填写时同样触发重命名
- **删除**：直接删除当前视频（无确认弹窗）
- **播放**：调用 PotPlayer 打开当前视频
- **文件名回填**：重新扫描目录时会尝试从 `{score}-{tags}-{code}` 文件名自动读入评分和标签；不符合格式则跳过

### 快捷键

- `Left`：上一个
- `Right`：下一个（仅评分+标签完整时重命名）
- `Enter`：确认（仅评分+标签完整时重命名并下一个）
- `1~0`：快速评分 `91~100`

---

## 6. 重命名规则（强约束）

固定格式：

```text
{score}-{tags}-{code}{ext}
```

- `score` 未选择时留空，但分隔符保留
- `tags` 未选择时留空，但分隔符保留
- `code` 为 6 位随机大写字母数字（A-Z0-9），用于避免重名
- 标签多选时用 `_` 连接，并自动清理 Windows 非法文件名字符

示例：
- `--A1B2C3.mp4`
- `97--A1B2C3.mp4`
- `97-风景_夜景-A1B2C3.mp4`

---

## 7. 本地数据文件

运行后会在项目目录生成：

- `state.json`：记录每个视频的评分/标签/code/重命名结果（按绝对路径索引）
- `.cache_screens/`：截图缓存目录（key=视频绝对路径+mtime）

